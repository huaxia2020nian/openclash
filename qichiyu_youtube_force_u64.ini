; ================================================
; qichiyu_tv_clean_fix_v6.4.ini  （登录增强版）
; - Google & YouTube 全家桶统一出口（默认 🇺🇸 美国自动）
; - 加强：Google 登录 / 设备认证 / OAuth 强制命中同一策略（解决扫码“找不到服务器”）
; - AI 默认 🇸🇬 新加坡
; - DNS Fake-IP 强制；时间/NTP/联网探测直连；过滤置后
; ================================================


# ---------- DNS（强制经 Clash 解析） ----------
custom_dns=<<EOF
dns:
  enable: true
  listen: 0.0.0.0:7874
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - 8.8.4.4
  fallback:
    - 1.0.0.1
    - 9.9.9.9
  fake-ip-filter:
    - '*.lan'
    - '*.local'
    - '*.localdomain'
    - 'stun.l.google.com'
    - 'stun.*.*'
    - '*.stun.*'
    - 'time.*'
    - '*.ntp.*'
    - '*.ntp.org'
    - 'pool.ntp.org'
    - 'time.apple.com'
    - 'time.windows.com'
    - 'time.android.com'
    - 'ntp.aliyun.com'
    - 'ntp.tencent.com'
    - 'connectivitycheck.gstatic.com'
    - 'clients3.google.com'
    - '*.msftconnecttest.com'
    - '*.msftncsi.com'
EOF

enable_rule_generator=true
overwrite_original_rules=true
force_dns_mapping=true
dns_fallback_filter=geoip:!cn,public

# ========== 规则（顺序重要：G&Y 置顶，登录域名最靠前） ==========

; 0) (Optional) IoT devices always DIRECT (uncomment and edit IPs/CIDR)
; ruleset=🎯 全球直连,[]SRC-IP-CIDR,192.168.6.100/32,no-resolve  ; Example: camera
; ruleset=🎯 全球直连,[]SRC-IP-CIDR,192.168.6.101/32,no-resolve  ; Example: smart switch
; ruleset=🎯 全球直连,[]SRC-IP-CIDR,192.168.6.0/24,no-resolve    ; Example: whole IoT subnet
; ---- 登录/授权/设备激活：强制命中 G&Y（默认美国自动）----
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,accounts.google.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,oauth.googleusercontent.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,deviceauth.googleapis.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,youtubei.googleapis.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,ssl.gstatic.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,clients3.google.com

; ---- Google & YouTube 统一到 G&Y（页面/接口/视频流/静态资源一致）----
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,youtube.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,youtu.be
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,youtube.googleapis.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,googlevideo.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,ytimg.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,ggpht.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,google.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,googleapis.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,gstatic.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,doubleclick.net
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,withgoogle.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,googletagservices.com
ruleset=📺 G&Y,[]DOMAIN-SUFFIX,googletagmanager.com

; ---- AI（默认新加坡；只匹配 AI 站点/接口，避免与 G&Y 冲突）----
ruleset=🤖 AI,[]DOMAIN-SUFFIX,openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,chat.openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,api.openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,oaiusercontent.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,oaistatic.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,cdn.openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,auth0.openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,auth0.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,gemini.google.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,ai.google.dev
ruleset=🤖 AI,[]DOMAIN-SUFFIX,aistudio.google.com
ruleset=🤖 AI,[]DOMAIN,generativelanguage.googleapis.com
ruleset=🤖 AI,[]DOMAIN,palm.googleapis.com
ruleset=🤖 AI,[]DOMAIN,makersuite.google.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,anthropic.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,claude.ai
ruleset=🤖 AI,[]DOMAIN-SUFFIX,cohere.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,perplexity.ai
ruleset=🤖 AI,[]DOMAIN-SUFFIX,groq.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,openrouter.ai
ruleset=🤖 AI,[]DOMAIN-SUFFIX,replicate.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,stability.ai
ruleset=🤖 AI,[]DOMAIN-SUFFIX,huggingface.co
ruleset=🤖 AI,[]DOMAIN-SUFFIX,deepseek.com

; ---- 时间/NTP/联网探测：直连 ----
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,time.apple.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,time.windows.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,time.android.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,ntp.aliyun.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,ntp.tencent.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,pool.ntp.org
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,connectivitycheck.gstatic.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,clients3.google.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,msftconnecttest.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,msftncsi.com

; ---- 基础分流 ----
ruleset=🎯 全球直连,[]GEOSITE,CN
ruleset=🎯 全球直连,[]GEOIP,CN,no-resolve
ruleset=🚀 节点选择,[]GEOSITE,geolocation-!cn

; ---- 过滤（置后）----
ruleset=🛑 广告拦截,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyList.list
ruleset=🧹 应用净化,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanProgramAD.list
ruleset=🔒 隐私防护,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanPrivacy.list

; 兜底
ruleset=🐟 漏网之鱼,[]FINAL

# ---------- 策略组 ----------
custom_proxy_group=🚀 节点选择`select`[]🇯🇵 日本自动`[]🇺🇸 美国自动`[]🇬🇧 英国自动`[]🇸🇬 新加坡自动`[]🇭🇰 香港自动`[]DIRECT

; 自动测速
custom_proxy_group=🇯🇵 日本自动`url-test`(日|JP|Japan|东京|大阪|NRT|TYO)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇺🇸 美国自动`url-test`(美|US|United States|美国|洛杉矶|LA|达拉斯|Dallas|芝加哥|Chicago|纽约|NY|西雅图|Seattle|圣何塞|San Jose|Ashburn|阿什本)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇬🇧 英国自动`url-test`(英|UK|United Kingdom|伦敦|London|GB|GBR|UK)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇸🇬 新加坡自动`url-test`(新加坡|SG|Singapore|SGP)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇭🇰 香港自动`url-test`(港|HK|Hong|香港|HKG)`http://www.gstatic.com/generate_204`300,,50

; 手动挑节点（保留）
custom_proxy_group=🇺🇸 美国手动`select`(美|US|United States|美国|洛杉矶|LA|达拉斯|Dallas|芝加哥|Chicago|纽约|NY|硅谷|San Jose|圣何塞|西雅图|Seattle|波特兰|Portland|迈阿密|Miami|阿什本|Ashburn)
custom_proxy_group=🇬🇧 英国手动`select`(英|UK|United Kingdom|英国|伦敦|London|GB|GBR|UK)

; 分配
custom_proxy_group=🎯 全球直连`select`[]DIRECT`[]🚀 节点选择
; AI 默认新加坡
custom_proxy_group=🤖 AI`select`[]🇸🇬 新加坡自动`[]🇯🇵 日本自动`[]🇺🇸 美国自动
; G&Y 默认美国自动（并保留美国手动；失败自动回退到英→日→新→直连）
custom_proxy_group=📺 G&Y`fallback`[]🇺🇸 美国自动`[]🇺🇸 美国手动`[]🇬🇧 英国自动`[]🇯🇵 日本自动`[]🇸🇬 新加坡自动`[]DIRECT`http://www.gstatic.com/generate_204`300
custom_proxy_group=🛑 广告拦截`select`[]REJECT`[]DIRECT
custom_proxy_group=🧹 应用净化`select`[]REJECT`[]DIRECT
custom_proxy_group=🔒 隐私防护`select`[]REJECT`[]DIRECT
custom_proxy_group=🐟 漏网之鱼`select`[]🚀 节点选择`[]DIRECT
