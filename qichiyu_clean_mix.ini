; ================================================
; qichiyu_tv_clean_fix_v5.ini
; 目标：
; - 修复手机/电视 YouTube 打不开（统一 DNS 进 Clash fake-ip）
; - 电脑/手机/电视的 YouTube 可用且可在面板将其切到【英国手动】
; - ChatGPT 更稳（AI 组可切换）
; - 电视时间/登录探测直连（不再受代理影响）
; 适配：OpenClash TUN-混合 + Fake-IP 模式
; ================================================

; ---------- DNS 内联注入（强制经 Clash 解析） ----------
custom_dns=<<EOF
dns:
  enable: true
  listen: 0.0.0.0:7874
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - 8.8.4.4
  fallback:
    - 1.0.0.1
    - 9.9.9.9
  fake-ip-filter:   # 这些直连解析，保证时间/联网探测/局域网正常
    - '*.lan'
    - '*.local'
    - '*.localdomain'
    - 'stun.l.google.com'
    - 'stun.*.*'
    - '*.stun.*'
    - 'time.*'
    - '*.ntp.*'
    - '*.ntp.org'
    - 'pool.ntp.org'
    - 'time.apple.com'
    - 'time.windows.com'
    - 'time.android.com'
    - 'ntp.aliyun.com'
    - 'ntp.tencent.com'
    - 'connectivitycheck.gstatic.com'
    - 'clients3.google.com'
    - '*.msftconnecttest.com'
    - '*.msftncsi.com'
EOF

; 让 Clash 生成规则并覆盖订阅原规则，且强制 DNS 映射走内核
enable_rule_generator=true
overwrite_original_rules=true
force_dns_mapping=true
dns_fallback_filter=geoip:!cn,public

; ---------- YouTube（完整域名集，统一交给“📺 YouTube”策略组） ----------
ruleset=📺 YouTube,[]DOMAIN-SUFFIX,youtube.com
ruleset=📺 YouTube,[]DOMAIN-SUFFIX,youtubei.googleapis.com
ruleset=📺 YouTube,[]DOMAIN-SUFFIX,googlevideo.com
ruleset=📺 YouTube,[]DOMAIN-SUFFIX,ytimg.com
ruleset=📺 YouTube,[]DOMAIN-SUFFIX,ggpht.com
ruleset=📺 YouTube,[]DOMAIN-SUFFIX,youtu.be

; ---------- Google 登录与静态资源（提前，避免被拦） ----------
ruleset=🚀 节点选择,[]DOMAIN-SUFFIX,google.com
ruleset=🚀 节点选择,[]DOMAIN-SUFFIX,googleapis.com
ruleset=🚀 节点选择,[]DOMAIN-SUFFIX,gstatic.com
ruleset=🚀 节点选择,[]DOMAIN-SUFFIX,accounts.google.com
ruleset=🚀 节点选择,[]DOMAIN-SUFFIX,recaptcha.net
ruleset=🚀 节点选择,[]DOMAIN-SUFFIX,oauth.googleusercontent.com

; ---------- ChatGPT / OpenAI ----------
ruleset=🤖 AI,[]DOMAIN-SUFFIX,openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,chat.openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,api.openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,oaiusercontent.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,oaistatic.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,cdn.openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,auth0.openai.com
ruleset=🤖 AI,[]DOMAIN-SUFFIX,auth0.com

; ---------- 时间/NTP/连网探测直连（保证电视时间/登录） ----------
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,time.apple.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,time.windows.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,time.android.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,ntp.aliyun.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,ntp.tencent.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,pool.ntp.org
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,connectivitycheck.gstatic.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,clients3.google.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,msftconnecttest.com
ruleset=🎯 全球直连,[]DOMAIN-SUFFIX,msftncsi.com

; ---------- 基础分流 ----------
ruleset=🎯 全球直连,[]GEOSITE,CN
ruleset=🎯 全球直连,[]GEOIP,CN,no-resolve
ruleset=🚀 节点选择,[]GEOSITE,geolocation-!cn

; ---------- 过滤（放最后，避免影响登录/播放） ----------
ruleset=🛑 广告拦截,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyList.list
ruleset=🧹 应用净化,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanProgramAD.list
ruleset=🔒 隐私防护,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanPrivacy.list

; 兜底
ruleset=🐟 漏网之鱼,[]FINAL

; ---------- 策略组 ----------
; 顶层：国外默认日本；可手动切到其它
custom_proxy_group=🚀 节点选择`select`[]🇯🇵 日本自动`[]🇺🇸 美国自动`[]🇬🇧 英国自动`[]🇸🇬 新加坡自动`[]🇭🇰 香港自动`[]DIRECT

; 自动测速分组（按常见命名匹配关键字）
custom_proxy_group=🇯🇵 日本自动`url-test`(日|JP|Japan|东京|大阪|NRT|TYO)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇺🇸 美国自动`url-test`(美|US|United States|美国|洛杉矶|LA|达拉斯|Dallas|芝加哥|Chicago|纽约|NY|西雅图|Seattle|圣何塞|San Jose|Ashburn|阿什本)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇬🇧 英国自动`url-test`(英|UK|United Kingdom|伦敦|London|GB|GBR|UK)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇸🇬 新加坡自动`url-test`(新加坡|SG|Singapore|SGP)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇭🇰 香港自动`url-test`(港|HK|Hong|香港|HKG)`http://www.gstatic.com/generate_204`300,,50

; 手动分组（便于精确挑某个 US/UK 节点）
custom_proxy_group=🇺🇸 美国手动`select`(美|US|United States|美国|洛杉矶|LA|达拉斯|Dallas|芝加哥|Chicago|纽约|NY|硅谷|San Jose|圣何塞|西雅图|Seattle|波特兰|Portland|迈阿密|Miami|阿什本|Ashburn)
custom_proxy_group=🇬🇧 英国手动`select`(英|UK|United Kingdom|英国|伦敦|London|GB|GBR|UK)

; 规则对应策略
custom_proxy_group=🎯 全球直连`select`[]DIRECT`[]🚀 节点选择
custom_proxy_group=🤖 AI`select`[]🇯🇵 日本自动`[]🇸🇬 新加坡自动`[]🇺🇸 美国自动
; YouTube 专属策略组：默认随“节点选择”（日本），可手动切到英国手动/美国手动
custom_proxy_group=📺 YouTube`select`[]🚀 节点选择`[]🇬🇧 英国手动`[]🇺🇸 美国手动`[]🇬🇧 英国自动`[]🇺🇸 美国自动`[]🇯🇵 日本自动`[]🇸🇬 新加坡自动`[]DIRECT
custom_proxy_group=🛑 广告拦截`select`[]REJECT`[]DIRECT
custom_proxy_group=🧹 应用净化`select`[]REJECT`[]DIRECT
custom_proxy_group=🔒 隐私防护`select`[]REJECT`[]DIRECT
custom_proxy_group=🐟 漏网之鱼`select`[]🚀 节点选择`[]DIRECT
